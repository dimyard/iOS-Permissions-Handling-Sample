# iOS Permissions Handling для Appium

Проект демонстрирует решение проблемы с обработкой системных запросов разрешений в iOS при тестировании с Appium.

## Проблема

При автоматизированном тестировании iOS-приложений с использованием Appium возникает специфическая проблема:
1. Appium начал требовать переключение на системное приложение при работе с разрешениями
2. При переключении на системное приложение теряется состояние текущего приложения
3. Это затрудняет автоматическую обработку разных типов разрешений
4. Автоматическое подтверждение запросов ведет себя непредсказуемо

## Решение

Данный проект предлагает элегантное решение проблемы:
1. Обнаружение диалогов разрешений через поиск характерных системных кнопок
2. Создание скриншота экрана при обнаружении запроса разрешения
3. Распознавание текста диалога с использованием OCR (Tesseract)
4. Определение типа разрешения на основе ключевых слов в тексте
5. Использование mobile:alert API для взаимодействия с кнопками диалога

## Особенности

- Работа с системными диалогами iOS без потери контекста
- Распознавание различных типов разрешений по тексту
- Кроссплатформенная реализация 
- Настраиваемые ключевые слова для разных языков интерфейса

## Примеры использования

```csharp
// Инициализация драйвера и обработчика разрешений

AppiumPreset preset = new AppiumPreset() { DeviceName = "iPhone 15 Pro Max", PlatformVersion = "17.5" };
var driverWrapper = new AppiumDriverWrapper(preset);
var permissionHandler = new PermissionHandler(driverWrapper);

// Обработка разрешения, если оно появляется
var handlingResult = new PermissionHandler(driverWrapper).HandlePermissionIfPresent();
if (handlingResult.Found && handlingResult.Handled)
{
    Console.WriteLine($"Разрешение {handlingResult.PermissionType} успешно обработано");
}
```

## Требования

- .NET 9.0 
- Appium 
- XCUITest драйвер
- Tesseract OCR с языковыми пакетами
- iOS-устройство или симулятор

## Структура проекта

- **Core/Driver**: Компоненты для работы с Appium
- **Core/OCR**: Компоненты для распознавания текста
- **Permissions/Models**: Модели запросов разрешений
- **Permissions/Handlers**: Обработчики разрешений

## Установка и запуск

1. Клонируйте репозиторий
2. Запустите Appium Server
3. Пропишите параметры устройства в AppiumPreset, пропишите адрес сервера в _appiumServerUri если он не локальный.
4. Запустите проект

## Лицензия

MIT